# Configuration variables
$WebURL = "http://spwfe"
$SourceListName = "List1"
$TargetListName = "List2"
$BatchSize = 500

# Get Objects
$web = Get-SPWeb $WebURL
$SourceList = $web.Lists[$SourceListName]
$TargetList = $web.Lists[$TargetListName]

# Get all source items
$SourceColumns = $SourceList.Fields
$SourceItems = $SourceList.GetItems()

# Iterate through each item and add to the target list in batches
for ($i = 0; $i -lt $SourceItems.Count; $i += $BatchSize) {
    $batch = $SourceItems[$i..($i + $BatchSize - 1)]

    foreach ($SourceItem in $batch) {
        $TargetItem = $TargetList.AddItem()

        # Copy field values from source item to destination item
        foreach ($column in $SourceColumns) {
            if ($column.ReadOnlyField -eq $False -and $column.InternalName -ne "Attachments") {
                $TargetItem[$($column.InternalName)] = $SourceItem[$($column.InternalName)]
            }
        }
        
        # Copy attachments
        foreach ($Attachment in $SourceItem.Attachments) {
            $spFile = $SourceList.ParentWeb.GetFile($SourceItem.Attachments.UrlPrefix + $Attachment)
            $TargetItem.Attachments.Add($Attachment, $spFile.OpenBinary())
        }

        # Update and commit the changes
        $TargetItem.Update()
    }

    Write-Host "Copied $($i + $BatchSize) items out of $($SourceItems.Count) items."
}

Write-Host "List items with attachments copied successfully!"
